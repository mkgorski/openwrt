#!/bin/sh

mount -t proc proc /proc
mount -t sysfs none /sys

mknod /dev/mmcblk0 b 179 0
mknod /dev/mmcblk0p3 b 179 3
mknod /dev/mmcblk0p4 b 179 4

mknod /dev/btrfs-control c 10 234
btrfs device scan
if ! mount -t btrfs /dev/mmcblk0p3 /mnt; then
  exec /bin/busybox sh
fi
cd /mnt
exec switch_root /mnt /sbin/init